;(function(e,c,g){var d="bootstrapCollection",a=c.document,f={allow_add:false,allow_delete:false,sortable:false,sortable_field:"position",prototype_name:"__name__",trans:{new_label:"New item",confirm:"Are you sure you want to delete this element?",confirm_batch:"Are you sure you want to delete all selected elements?"},javascript:function(h){}};function b(i,h){this.element=i;this.$element=e("#"+i.id);this.options=e.extend({},f,h);this._defaults=f;this._name=d;this._init();}b.prototype={_init:function(){var h=this;if(this.options.allow_add){this.$new=e("#"+this.element.id+"_toolbar > .new");this.nextId=this.$element.children(".collection").children(".collection-item").length;this.$new.on("click",function(j){j.preventDefault();var i=e.Event("adding");h.$element.trigger(i);if(!i.isDefaultPrevented()){h._onAdd();h.$element.trigger("added");}});}if(this.options.allow_delete){e("."+this.element.id+"_actions .delete").click(function(j){j.preventDefault();var i=e.Event("deleting");var k=e(this).closest(".collection-item");h.$element.trigger(i,[k]);if(!i.isDefaultPrevented()){h._onDelete(this);h.$element.trigger("deleted",[k]);}});this.$toggleAll=e("#"+this.element.id+'_toolbar > .btn-toggle > input[name="toggle"]');this.$toggleAll.on("change",function(i){h._onToggleAll();});e("#"+this.element.id+"_toolbar > .batch-delete").click(function(){var i=e.Event("deleting-all");h.$element.trigger(i);if(!i.isDefaultPrevented()){h._onDeleteAll();h.$element.trigger("deleted-all");}});}if(this.options.sortable){e("#"+this.element.id+" > .collection").sortable({update:function(j,i){h._onChange();},cancel:"a, button, img, input, textarea, select, iframe, .cke div, .cke span",start:function(i,j){h.ckeConfigs=[];e("textarea",j.item).each(function(){var l=e(this).attr("id");if(CKEDITOR.instances[l]){var k=e(this).next(".cke").clone().addClass("cloned");h.ckeConfigs[l]=CKEDITOR.instances[l].config;CKEDITOR.instances[l].destroy();e(this).hide().after(k);}});},stop:function(i,j){e("textarea",j.item).each(function(){var k=e(this).attr("id");if(h.ckeConfigs[k]){CKEDITOR.replace(k,h.ckeConfigs[k]);e(this).next(".cloned").remove();}});}});}},_onAdd:function(){var j=e("#"+this.element.id).data("prototype");var h=this.nextId;j=j.replace(new RegExp("label__","g"),this.options.trans.new_label);j=j.replace(new RegExp(this.options.prototype_name,"g"),h);$new_item=e(j);if(this.options.allow_delete){var i=this;$new_item.find(".delete").click(function(){var k=e.Event("deleting");var l=e(this).closest(".collection-item");i.$element.trigger(k,[l]);if(!k.isDefaultPrevented()){i._onDelete(this);i.$element.trigger("deleted",[l]);}});}this.nextId++;e("#"+this.element.id+" > .collection").append($new_item);this.options.javascript.call(c,this.element.id+"_"+h);if(this.options.sortable){this._onChange();}},_onDelete:function(h){if(confirm(this.options.trans.confirm)){e(h).closest(".collection-item").remove();if(this.options.sortable){this._onChange();}}},_onChange:function(){e('[id^="'+this.element.id+'"][id$="'+this.options.sortable_field+'"]').each(function(h){e(this).val(h);});},_onToggleAll:function(){if(this.$toggleAll.is(":checked")){this.$toggleAll.prop("checked",true);e("."+this.element.id+'_actions > .btn-toggle > input[name="delete"]').prop("checked",true);}else{this.$toggleAll.prop("checked",false);e("."+this.element.id+'_actions > .btn-toggle > input[name="delete"]').prop("checked",false);}},_onDeleteAll:function(){if(confirm(this.options.trans.confirm_batch)){e("."+this.element.id+'_actions > .btn-toggle > input[name="delete"]:checked').each(function(){e(this).closest(".collection-item").remove();});if(this.options.sortable){this._onChange();}this.$toggleAll.prop("checked",false);}}};e.fn[d]=function(i){var h=arguments;if(i===g||typeof i==="object"){return this.each(function(){if(!e.data(this,"plugin_"+d)){e.data(this,"plugin_"+d,new b(this,i));}});}else{if(typeof i==="string"&&i[0]!=="_"&&i!=="init"){var j;this.each(function(){var k=e.data(this,"plugin_"+d);if(k instanceof b&&typeof k[i]==="function"){j=k[i].apply(k,Array.prototype.slice.call(h,1));}if(i==="destroy"){e.data(this,"plugin_"+d,null);}});return j!==g?j:this;}}};}(jQuery,window));
