;$.widget("blueimp.fileupload",$.blueimp.fileupload,{_cleanInputsFile:function(){if(this.options.uploadOnSubmit){this.options.fileInput.prop("value","")}},_initButtonBarEventHandlers:function(){var e=this;var t=this.element.find(".fileupload-buttonbar"),n=this.options.filesContainer;this._on(t.find(".start"),{click:function(t){t.preventDefault();n.find("button.start").click();e._cleanInputsFile()}});this._on(t.find(".cancel"),{click:function(t){t.preventDefault();n.find("button.cancel").click();e._cleanInputsFile()}});this._on(t.find(".delete"),{click:function(r){r.preventDefault();if(confirm(e.options.messages.confirmBatchDelete)){n.find("input[name=delete]:checked").parent().siblings("button").click();t.find(".toggle").prop("checked",false)}}});this._on(t.find(".toggle"),{change:function(e){n.find("input[name=delete]").prop("checked",$(e.currentTarget).is(":checked"))}})},_cancelWaitingUploads:function(e,t){this.options.filesContainer.find(".cancel").click()},_uploadCompleted:function(e,t){if(t.files){this._renderPreviews(t);t.context.find("button.remove").on("click",function(e){e.preventDefault();t.context.find(".form input[type=checkbox].remove").prop("checked",true).end().hide()})}},_initEventHandlers:function(){this._super();if(this.options.uploadOnSubmit){this._on({fileuploadchange:this._cancelWaitingUploads})}else{this._on({fileuploadcompleted:this._uploadCompleted})}}});(function(e,t,n){function o(t,n){this.element=t;this.options=e.extend({},s,n);this._defaults=s;this._name=r;this._init()}var r="uploadCollection",i=t.document,s={sortable:false,sortable_field:"position",messages:{maxNumberOfFiles:"Maximum number of files exceeded",acceptFileTypes:"File type not allowed",maxFileSize:"File is too big",minFileSize:"File is too small",confirmBatchDelete:"Are you sure you want to delete all selected elements?"},javascript:function(e){}};o.prototype={_init:function(){var t=this;this.$element=e(this.element);this.$widgetContainer=e("#"+this.element.id+"_widget_container");this.$filesContainer=e("#"+this.element.id+"_files_list");this.$progressBarContainer=this.$widgetContainer.find(".fileupload-progressbar");this.waitingToUpload=0;this.submitOnFinish=false;this.$widgetContainer.fileupload({messages:this.options.messages,fileInput:this.$element,replaceFileInput:false,uploadTemplateId:this.element.id+"_upload_template",downloadTemplateId:this.element.id+"_download_template",filesContainer:this.$filesContainer,dropZone:this.$widgetContainer,pasteZone:this.$widgetContainer,maxNumberOfFiles:this.options.maxNumberOfFiles,maxFileSize:this.options.maxFileSize,minFileSize:this.options.minFileSize,acceptFileTypes:this.options.acceptFileTypes,previewAsCanvas:this.options.previewAsCanvas,prependFiles:this.options.prependFiles,previewSourceFileTypes:this.options.previewSourceFileTypes,previewSourceMaxFileSize:this.options.previewSourceMaxFileSize,previewMaxWidth:this.options.previewMaxWidth,previewMaxHeight:this.options.previewMaxHeight,autoUpload:this.options.autoUpload,url:this.options.urlUpload,uploadOnSubmit:!this.options.autoUpload&&!this.options.urlUpload,progressall:function(e,n){if(n.total!=0){var r=parseInt(n.loaded/n.total*100,10);t.$progressBarContainer.find(".bar").css("width",r+"%")}},start:function(e){t.$progressBarContainer.show()},stop:function(e){t.$progressBarContainer.hide()}});if(!this.options.autoUpload&&this.options.urlUpload){this.$widgetContainer.bind("fileuploadadd",function(e,n){n.formData={propertyPath:n.paramName};t.waitingToUpload+=1}).bind("fileuploadcompleted",function(e,n){t.waitingToUpload-=1}).bind("fileuploadfailed",function(e,n){t.waitingToUpload-=1}).bind("fileuploadfinished",function(e,n){if(0==t.waitingToUpload&&t.submitOnFinish){t.$element.parents("form").submit()}});this.$element.parents("form").on("submit",function(e){if(t.waitingToUpload>0){t.submitOnFinish=true;t.$element.parents("form").find(".fileupload-buttonbar .start").click();e.preventDefault();return}t.$element.remove()})}if(this.options.sortable){e("#"+this.element.id+"_files_list").sortable({helper:function(t,n){n.children().each(function(){e(this).css("width",e(this).width())});return n},handle:".handle",cursor:"move",items:"> tr.template-download",axis:"y",forceHelperSize:true,forcePlaceholderSize:true,placeholder:"sortable-placeholder",over:function(e,n){var r=t.$filesContainer.find("tr.ui-sortable-helper");var i=t.$filesContainer.find("tr.sortable-placeholder");i.css("height",r.height())},update:function(n,r){r.item.children().each(function(){e(this).css("width","")});e('[id^="'+t.element.id+'"][id$="'+t.options.sortable_field+'"]').each(function(t){e(this).val(t)})},start:function(n,r){t.ckeConfigs=[];e("textarea",r.item).each(function(){var n=e(this).attr("id");if(CKEDITOR.instances[n]){var r=e(this).next(".cke").clone().addClass("cloned");t.ckeConfigs[n]=CKEDITOR.instances[n].config;CKEDITOR.instances[n].destroy();e(this).hide().after(r)}})},stop:function(n,r){e("textarea",r.item).each(function(){var n=e(this).attr("id");if(t.ckeConfigs[n]){CKEDITOR.replace(n,t.ckeConfigs[n]);e(this).next(".cloned").remove()}})}})}},loadFiles:function(e){this.$widgetContainer.fileupload("option","done").call(this.$widgetContainer,null,{result:e})}};e.fn[r]=function(t){var i=arguments;if(t===n||typeof t==="object"){return this.each(function(){if(!e.data(this,"plugin_"+r)){e.data(this,"plugin_"+r,new o(this,t))}})}else if(typeof t==="string"&&t[0]!=="_"&&t!=="init"){var s;this.each(function(){var n=e.data(this,"plugin_"+r);if(n instanceof o&&typeof n[t]==="function"){s=n[t].apply(n,Array.prototype.slice.call(i,1))}if(t==="destroy"){e.data(this,"plugin_"+r,null)}});return s!==n?s:this}}})(jQuery,window);