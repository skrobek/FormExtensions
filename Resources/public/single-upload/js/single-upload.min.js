;(function(e,c,g){var d="singleUpload",a=c.document,f={maxWidth:320,maxHeight:180,minWidth:16,minHeight:16,previewImages:true,previewAsCanvas:true,isEmpty:true,nameable:false,deleteable:false,widget_name:null,filetypes:{audio:"Audio",archive:"Archive",html:"HTML",image:"Image","pdf-document":"PDF<br />Document","plain-text":"Plain<br />Text",presentation:"Presentation",spreadsheet:"Spreadsheet","text-document":"Text<br />Document",unknown:"Unknown<br />Filetype",video:"Video"}};function b(i,h){this.element=i;this.options=e.extend({},f,h);this._defaults=f;this._name=d;this._init();}b.prototype={_init:function(){var h=this;this.$widgetContainer=e("#"+this.element.id+"_widget_container");this.$addButton=this.$widgetContainer.find(".singleupload-buttonbar .add");this.$replaceButton=this.$widgetContainer.find(".singleupload-buttonbar .replace");this.$cancelButton=this.$widgetContainer.find(".singleupload-buttonbar .cancel");this.$deleteButton=this.$widgetContainer.find(".singleupload-buttonbar .delete");this.isDeletable=(!this.options.isEmpty&&this.options.deleteable);if(this.options.deleteable){this.$deleteFlag=e("#"+this.element.id+"_delete");}if(this.isDeletable){this.$deleteButton.show();}this._resetInput();e(this.element).on("change",function(){h._onChange();});this.$cancelButton.click(function(){h._onCancel();});this.$deleteButton.click(function(){h._onDelete();});},_onChange:function(){var h=this.element.files[0];this.$cancelButton.removeClass("disabled").show("slide",{direction:"left"},"slow");if(this.isEmpty){this.$addButton.hide();this.$replaceButton.show();}if(this.isDeletable){this.$deleteButton.addClass("disabled").hide("slide",{direction:"right"},"slow");}(this.options.previewImages&&this._isImage(h))?this._onPreviewImage():this._onPreviewFile();},_onCancel:function(){this.$cancelButton.addClass("disabled").hide("slide",{direction:"left"},"slow");if(this.isEmpty){this.$replaceButton.hide();this.$addButton.show();}if(this.isDeletable&&!this.isEmpty){this.$deleteButton.removeClass("disabled").show("slide",{direction:"right"},"slow");}var h=e("."+this.element.id+"_preview_image.active");var i=e("."+this.element.id+"_preview_image.download");if(h.hasClass("download")){return;}if(this.options.nameable){h.find(".nameable").removeAttr("name");i.find(".nameable").removeAttr("disabled");}this._resetInput();i.slideDown({duration:"slow",queue:false,complete:function(){e(this).addClass("active");}});h.slideUp({duration:"slow",queue:false,complete:function(){e(this).remove();}});},_onDelete:function(){var h=this;var i=e("."+this.element.id+"_preview_image.download");if(!this.isDeletable){return;}this.$replaceButton.hide();this.$addButton.show();this.$deleteButton.parent().addClass("removed").end();this.$deleteButton.addClass("disabled").hide("slide",{direction:"left",queue:false,complete:function(){h.$deleteButton.parent().remove();}},"slow");i.slideUp({duration:"slow",queue:false,complete:function(){e(this).empty();}});this.$deleteFlag.val(1);this.isDeletable=false;this.isEmpty=true;},_onPreviewImage:function(){var i=this;var h=this.element.files[0];c.loadImage(h,function(k){var l=e("."+i.element.id+"_preview_image.active");var m=l.clone().empty().hide().removeClass("download").addClass("upload");if(i.options.nameable){l.find(".nameable").attr("disabled","disabled");var n=e("<div/>").addClass("row-fluid").html(e("<input/>").attr("type","text").addClass("nameable").attr("name",i.options.widget_name+"[name]").val(h.name));}else{var n=e("<div/>").addClass("row-fluid").text(h.name);}var j=e("<div/>").addClass("row-fluid").text(i._bytesToSize(h.size));m.appendTo(l.parent()).html(e(k).addClass("img-polaroid")).append(n).append(j);m.slideDown({duration:"slow",queue:false,complete:function(){e(this).addClass("active");}});l.slideUp({duration:"slow",queue:false,complete:function(){(e(this).hasClass("download"))?e(this).removeClass("active"):e(this).remove();}});},{maxWidth:i.options.maxWidth,maxHeight:i.options.maxHeight,minWidth:i.options.minWidth,minHeight:i.options.minHeight,canvas:i.options.previewAsCanvas,noRevoke:true});},_onPreviewFile:function(){var l=e("."+this.element.id+"_preview_image.active");var m=l.clone().empty().hide().removeClass("download").addClass("upload");var k=this.element.files[0];var j=this._checkFileType(k);var i=e("<div/>").addClass("fileicon").addClass(j).html(this.options.filetypes[j]);if(this.options.nameable){l.find(".nameable").attr("disabled","disabled");var n=e("<div/>").addClass("row-fluid").html(e("<input/>").attr("type","text").addClass("nameable").attr("name",this.options.widget_name+"[name]").val(k.name));}else{var n=e("<div/>").addClass("row-fluid").text(k.name);}var h=e("<div/>").addClass("row-fluid").text(this._bytesToSize(k.size));m.appendTo(l.parent()).html(i).append(n).append(h);m.slideDown({duration:"slow",queue:false,complete:function(){e(this).addClass("active");}});l.slideUp({duration:"slow",queue:false,complete:function(){(e(this).hasClass("download"))?e(this).removeClass("active"):e(this).remove();}});},_bytesToSize:function(i){var k=1024;var h=k*1024;var j=h*1024;var l=j*1024;if(i<k){return i+" B";}else{if(i<h){return(i/k).toFixed(2)+" KB";}else{if(i<j){return(i/h).toFixed(2)+" MB";}else{if(i<l){return(i/j).toFixed(2)+" GB";}else{return(i/l).toFixed(2)+" TB";}}}}},_checkFileType:function(h){if(this._isAudio(h)){return"audio";}if(this._isArchive(h)){return"archive";}if(this._isHTML(h)){return"html";}if(this._isImage(h)){return"image";}if(this._isPDFDocument(h)){return"pdf-document";}if(this._isPlainText(h)){return"plain-text";}if(this._isPresentation(h)){return"presentation";}if(this._isSpreadsheet(h)){return"spreadsheet";}if(this._isTextDocument(h)){return"text-document";}if(this._isVideo(h)){return"video";}return"unknown";},_isAudio:function(h){return(h.type.match("audio/.*"));},_isArchive:function(h){return(h.type.match("application/.*compress.*")||h.type.match("application/.*archive.*")||h.type.match("application/.*zip.*")||h.type.match("application/.*tar.*")||h.type.match("application/x-ace")||h.type.match("application/x-bz2")||h.type.match("gzip/document"));},_isHTML:function(h){return(h.type.match("text/html"));},_isImage:function(h){return(h.type.match("image/.*"));},_isPDFDocument:function(h){return(h.type.match("application/acrobat")||h.type.match("applications?/.*pdf.*")||h.type.match("text/.*pdf.*"));},_isPlainText:function(h){return(h.type.match("text/plain"));},_isPresentation:function(h){return(h.type.match("application/.*ms-powerpoint.*")||h.type.match("application/.*officedocument.presentationml.*")||h.type.match("application/.*opendocument.presentation.*"));},_isSpreadsheet:function(h){return(h.type.match("application/.*ms-excel.*")||h.type.match("application/.*officedocument.spreadsheetml.*")||h.type.match("application/.*opendocument.spreadsheet.*"));},_isTextDocument:function(h){return(h.type.match("application/.*ms-?word.*")||h.type.match("application/.*officedocument.wordprocessingml.*")||h.type.match("application/.*opendocument.text.*"));},_isVideo:function(h){return(h.type.match("video/.*"));},_resetInput:function(){var h=e(this.element).val("").clone(true);e(this.element).replaceWith(h);this.element=h[0];}};e.fn[d]=function(i){var h=arguments;if(i===g||typeof i==="object"){return this.each(function(){if(!e.data(this,"plugin_"+d)){e.data(this,"plugin_"+d,new b(this,i));}});}else{if(typeof i==="string"&&i[0]!=="_"&&i!=="init"){var j;this.each(function(){var k=e.data(this,"plugin_"+d);if(k instanceof b&&typeof k[i]==="function"){j=k[i].apply(k,Array.prototype.slice.call(h,1));}if(i==="destroy"){e.data(this,"plugin_"+d,null);}});return j!==g?j:this;}}};}(jQuery,window));